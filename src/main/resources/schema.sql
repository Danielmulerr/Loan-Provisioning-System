-- Create table for USERS
CREATE  TABLE IF NOT EXISTS USERS (
    USER_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    UUID VARCHAR(255) UNIQUE NOT NULL,
    FIRST_NAME VARCHAR(255) NOT NULL,
    LAST_NAME VARCHAR(255) NOT NULL,
    EMAIL VARCHAR(255) UNIQUE NOT NULL,
    PHONE VARCHAR(20) NOT NULL,
    CREATION_DATE TIMESTAMP,
    LAST_UPDATE_DATE TIMESTAMP
);

CREATE INDEX IF NOT EXISTS u_email_index ON USERS (EMAIL);
CREATE INDEX IF NOT EXISTS u_phone_index ON USERS (PHONE);
CREATE INDEX IF NOT EXISTS u_first_name_index ON USERS (FIRST_NAME);
CREATE INDEX IF NOT EXISTS u_uuid_index ON USERS (UUID);

-- Create table for LOAN_APPLICATION
CREATE  TABLE IF NOT EXISTS LOAN_APPLICATION (
    LOAN_APPLICATION_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID BIGINT NOT NULL REFERENCES USERS(USER_ID),
    LOAN_AMOUNT_REQUESTED DOUBLE PRECISION,
    TERM INTEGER,
    PURPOSE VARCHAR(255),
    BANK_ACCOUNT_NUMBER VARCHAR(255),
    STATUS VARCHAR(255),
    APPLICATION_DATE TIMESTAMP,
    APPROVAL_DATE TIMESTAMP,
    DISBURSEMENT_DATE TIMESTAMP,
    LAST_UPDATE_DATE TIMESTAMP,
    OUTSTANDING_BALANCE DOUBLE PRECISION,
    TOTAL_INTEREST_PAID DOUBLE PRECISION
);

-- Create table for LOAN_REPAYMENT
CREATE  TABLE IF NOT EXISTS LOAN_REPAYMENT (
    REPAYMENT_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    LOAN_APPLICATION_ID BIGINT NOT NULL REFERENCES LOAN_APPLICATION(LOAN_APPLICATION_ID),
    REPAYMENT_AMOUNT DOUBLE PRECISION NOT NULL,
    REPAYMENT_DATE TIMESTAMP NOT NULL
);

-- Create table for AUDIT_TRAIL_LOG
CREATE  TABLE IF NOT EXISTS AUDIT_TRAIL_LOG (
    AUDIT_TRAIL_LOG_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID BIGINT,
    PAGE_PATH VARCHAR(255),
    ACTION_TYPE VARCHAR(255) NOT NULL CHECK (ACTION_TYPE IN ('CREATE', 'UPDATE', 'DELETE', 'OTHER')),
    RESOURCE VARCHAR(255),
    DESCRIPTION VARCHAR(255),
    CREATION_DATE TIMESTAMP NOT NULL
);

CREATE INDEX IF NOT EXISTS a_t_user_id_index ON AUDIT_TRAIL_LOG (USER_ID);
CREATE INDEX IF NOT EXISTS a_t_page_path_index ON AUDIT_TRAIL_LOG (PAGE_PATH);

-- Create table for CREDIT_SCORE
CREATE  TABLE IF NOT EXISTS CREDIT_SCORE (
    CREDIT_SCORE_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID BIGINT NOT NULL REFERENCES USERS(USER_ID),
    CREDIT_SCORE INTEGER,
    DTI_RATIO DOUBLE PRECISION,
    MAX_DTI_RATIO DOUBLE PRECISION,
    CHANGE_OF_ADDRESS INTEGER,
    CHANGE_OF_ADDRESS_PERIOD INTEGER,
    LATE_RENTAL_PAYMENTS INTEGER,
    LATE_RENTAL_PAYMENTS_PERIOD INTEGER,
    LATE_CELL_PHONE_PAYMENTS INTEGER,
    LATE_CELL_PHONE_PAYMENTS_PERIOD INTEGER,
    SCORE_DATE TIMESTAMP,
    CREDIT_BUREAU_SOURCE VARCHAR(255),
    LAST_UPDATE_DATE TIMESTAMP
);
